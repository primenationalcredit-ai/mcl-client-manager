<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASAP Credit Repair - Financial Dashboard</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg-primary: #0a0e17;
            --bg-secondary: #111827;
            --bg-card: #1a2235;
            --bg-card-hover: #1f2a40;
            --border-color: #2a3548;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --accent-green: #10b981;
            --accent-green-light: #34d399;
            --accent-red: #ef4444;
            --accent-red-light: #f87171;
            --accent-blue: #3b82f6;
            --accent-yellow: #f59e0b;
            --accent-purple: #8b5cf6;
            --gradient-green: linear-gradient(135deg, #10b981 0%, #059669 100%);
            --gradient-red: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            --gradient-blue: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }
        body { font-family: 'DM Sans', -apple-system, sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }
        .app-container { max-width: 1600px; margin: 0 auto; padding: 24px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px; padding-bottom: 24px; border-bottom: 1px solid var(--border-color); }
        .logo-section { display: flex; align-items: center; gap: 16px; }
        .logo-icon { width: 48px; height: 48px; background: var(--gradient-green); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 20px; color: white; }
        .logo-text h1 { font-size: 24px; font-weight: 700; letter-spacing: -0.5px; }
        .logo-text span { font-size: 13px; color: var(--text-secondary); }
        .header-actions { display: flex; align-items: center; gap: 16px; }
        .sync-status { display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: var(--bg-card); border-radius: 8px; font-size: 13px; color: var(--text-secondary); }
        .sync-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--accent-green); animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .connect-btn { padding: 10px 20px; background: var(--gradient-blue); border: none; border-radius: 8px; color: white; font-weight: 600; font-size: 14px; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
        .connect-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4); }
        .date-filter { display: flex; gap: 8px; margin-bottom: 24px; }
        .date-btn { padding: 8px 16px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-secondary); font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.2s; }
        .date-btn:hover, .date-btn.active { background: var(--bg-card-hover); color: var(--text-primary); border-color: var(--accent-blue); }
        .date-btn.active { background: rgba(59, 130, 246, 0.15); }
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 32px; }
        .kpi-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 16px; padding: 24px; position: relative; overflow: hidden; transition: all 0.3s; }
        .kpi-card:hover { background: var(--bg-card-hover); border-color: var(--accent-blue); transform: translateY(-2px); }
        .kpi-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; }
        .kpi-card.revenue::before { background: var(--gradient-green); }
        .kpi-card.expenses::before { background: var(--gradient-red); }
        .kpi-card.profit::before { background: var(--gradient-blue); }
        .kpi-card.doo::before { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
        .kpi-label { font-size: 13px; color: var(--text-secondary); font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
        .kpi-value { font-size: 32px; font-weight: 700; letter-spacing: -1px; margin-bottom: 12px; }
        .kpi-card.revenue .kpi-value { color: var(--accent-green); }
        .kpi-card.expenses .kpi-value { color: var(--accent-red); }
        .kpi-card.profit .kpi-value { color: var(--accent-blue); }
        .kpi-card.doo .kpi-value { color: var(--accent-purple); }
        .kpi-change { display: flex; align-items: center; gap: 6px; font-size: 13px; font-weight: 500; }
        .kpi-change.positive { color: var(--accent-green); }
        .kpi-change.negative { color: var(--accent-red); }
        .charts-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 32px; }
        .chart-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 16px; padding: 24px; }
        .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .chart-title { font-size: 16px; font-weight: 600; }
        .chart-container { height: 300px; position: relative; }
        .categories-list { display: flex; flex-direction: column; gap: 16px; }
        .category-item { display: flex; align-items: center; justify-content: space-between; padding: 16px; background: var(--bg-secondary); border-radius: 12px; transition: all 0.2s; }
        .category-item:hover { background: var(--bg-card-hover); }
        .category-info { display: flex; align-items: center; gap: 12px; }
        .category-dot { width: 12px; height: 12px; border-radius: 4px; }
        .category-name { font-size: 14px; font-weight: 500; }
        .category-amount { font-size: 14px; font-weight: 600; font-family: 'JetBrains Mono', monospace; }
        .transactions-section { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 16px; padding: 24px; margin-bottom: 32px; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .section-title { font-size: 18px; font-weight: 600; }
        .filter-tabs { display: flex; gap: 8px; }
        .filter-tab { padding: 6px 14px; background: transparent; border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-secondary); font-size: 13px; cursor: pointer; transition: all 0.2s; }
        .filter-tab:hover, .filter-tab.active { background: var(--bg-card-hover); color: var(--text-primary); }
        .transactions-table { width: 100%; border-collapse: collapse; }
        .transactions-table th { text-align: left; padding: 12px 16px; font-size: 12px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid var(--border-color); }
        .transactions-table td { padding: 16px; font-size: 14px; border-bottom: 1px solid var(--border-color); }
        .transactions-table tr:last-child td { border-bottom: none; }
        .transactions-table tr:hover td { background: var(--bg-secondary); }
        .transaction-type { display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: 500; }
        .transaction-type.income { background: rgba(16, 185, 129, 0.15); color: var(--accent-green); }
        .transaction-type.expense { background: rgba(239, 68, 68, 0.15); color: var(--accent-red); }
        .amount-cell { font-family: 'JetBrains Mono', monospace; font-weight: 600; }
        .amount-cell.positive { color: var(--accent-green); }
        .amount-cell.negative { color: var(--accent-red); }
        .doo-section { background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(124, 58, 237, 0.05) 100%); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 16px; padding: 24px; margin-bottom: 32px; }
        .doo-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .doo-title { font-size: 18px; font-weight: 600; color: var(--accent-purple); }
        .doo-config { display: flex; align-items: center; gap: 12px; }
        .doo-config label { font-size: 13px; color: var(--text-secondary); }
        .doo-config input { width: 80px; padding: 8px 12px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-primary); font-size: 14px; font-family: 'JetBrains Mono', monospace; }
        .doo-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .doo-stat { text-align: center; padding: 20px; background: var(--bg-card); border-radius: 12px; }
        .doo-stat-label { font-size: 12px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
        .doo-stat-value { font-size: 28px; font-weight: 700; font-family: 'JetBrains Mono', monospace; color: var(--accent-purple); }
        .monthly-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 12px; margin-top: 24px; }
        .month-card { background: var(--bg-secondary); border-radius: 12px; padding: 16px; text-align: center; transition: all 0.2s; }
        .month-card:hover { background: var(--bg-card-hover); transform: translateY(-2px); }
        .month-card.current { border: 2px solid var(--accent-blue); background: rgba(59, 130, 246, 0.1); }
        .month-name { font-size: 12px; color: var(--text-secondary); margin-bottom: 8px; }
        .month-profit { font-size: 16px; font-weight: 700; font-family: 'JetBrains Mono', monospace; margin-bottom: 4px; }
        .month-profit.positive { color: var(--accent-green); }
        .month-profit.negative { color: var(--accent-red); }
        .month-revenue, .month-expenses { font-size: 11px; font-family: 'JetBrains Mono', monospace; }
        .month-revenue { color: var(--accent-green-light); }
        .month-expenses { color: var(--accent-red-light); }
        .setup-container { max-width: 600px; margin: 100px auto; text-align: center; }
        .setup-icon { width: 80px; height: 80px; background: var(--gradient-blue); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin: 0 auto 24px; font-size: 36px; }
        .setup-title { font-size: 28px; font-weight: 700; margin-bottom: 12px; }
        .setup-desc { font-size: 16px; color: var(--text-secondary); margin-bottom: 32px; line-height: 1.6; }
        .setup-btn { display: inline-flex; align-items: center; gap: 10px; padding: 16px 32px; background: var(--gradient-green); border: none; border-radius: 12px; color: white; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .setup-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(16, 185, 129, 0.4); }
        .loading-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(10, 14, 23, 0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; }
        .spinner { width: 48px; height: 48px; border: 3px solid var(--border-color); border-top-color: var(--accent-blue); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { margin-top: 16px; color: var(--text-secondary); }
        @media (max-width: 1200px) { .kpi-grid { grid-template-columns: repeat(2, 1fr); } .charts-grid { grid-template-columns: 1fr; } .monthly-grid { grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 768px) { .kpi-grid { grid-template-columns: 1fr; } .doo-grid { grid-template-columns: 1fr; } .monthly-grid { grid-template-columns: repeat(2, 1fr); } .header { flex-direction: column; gap: 16px; } }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const CONFIG = {
            API_BASE_URL: 'https://asap-financial-dashboard-backend-production-b444.up.railway.app',
            QUICKBOOKS_CLIENT_ID: 'ABlvo2Ct9EVpIvCAlMxuzVQITLsKwGl6r25k4W01DUSw5iLVOM',
            REDIRECT_URI: 'https://asap-financial-dashboard-backend-production-b444.up.railway.app/api/quickbooks/callback',
            DOO_DEFAULT_PERCENTAGE: 10
        };

        const DEMO_DATA = {
            summary: { totalRevenue: 187450.00, totalExpenses: 112670.00, netProfit: 74780.00, revenueChange: 12.5, expensesChange: -3.2, profitChange: 28.7 },
            monthlyData: [
                { month: 'Jul', revenue: 28500, expenses: 18200, profit: 10300 },
                { month: 'Aug', revenue: 31200, expenses: 19100, profit: 12100 },
                { month: 'Sep', revenue: 29800, expenses: 17800, profit: 12000 },
                { month: 'Oct', revenue: 33100, expenses: 20200, profit: 12900 },
                { month: 'Nov', revenue: 35200, expenses: 18900, profit: 16300 },
                { month: 'Dec', revenue: 29650, expenses: 18470, profit: 11180 }
            ],
            categories: [
                { name: 'Payroll', amount: 52300, color: '#ef4444' },
                { name: 'Software/Tools', amount: 18450, color: '#f59e0b' },
                { name: 'Marketing', amount: 15200, color: '#3b82f6' },
                { name: 'Merchant Fees', amount: 12800, color: '#8b5cf6' },
                { name: 'Uncategorized', amount: 13920, color: '#64748b' }
            ],
            transactions: [
                { id: 1, date: '2024-12-09', description: 'Client Payment - Johnson Family', category: 'Income', amount: 1499.00, type: 'income' },
                { id: 2, date: '2024-12-08', description: 'Stripe Monthly Fee', category: 'Merchant Fees', amount: -289.00, type: 'expense' },
                { id: 3, date: '2024-12-08', description: 'Client Payment - Williams', category: 'Income', amount: 999.00, type: 'income' },
                { id: 4, date: '2024-12-07', description: 'GoHighLevel Subscription', category: 'Software/Tools', amount: -497.00, type: 'expense' },
                { id: 5, date: '2024-12-07', description: 'Facebook Ads', category: 'Marketing', amount: -850.00, type: 'expense' },
                { id: 6, date: '2024-12-06', description: 'Client Payment - Martinez', category: 'Income', amount: 1299.00, type: 'income' },
                { id: 7, date: '2024-12-06', description: 'Consultant Commission - Sarah', category: 'Payroll', amount: -1200.00, type: 'expense' },
                { id: 8, date: '2024-12-05', description: 'Client Payment - Thompson', category: 'Income', amount: 799.00, type: 'income' }
            ]
        };

        const formatCurrency = function(amount) { return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(amount); };
        const formatPercent = function(value) { return (value >= 0 ? '+' : '') + value.toFixed(1) + '%'; };

        const KPICard = function(props) {
            return (
                <div className={"kpi-card " + props.type}>
                    <div className="kpi-label">{props.label}</div>
                    <div className="kpi-value">{formatCurrency(props.value)}</div>
                    <div className={"kpi-change " + (props.change >= 0 ? 'positive' : 'negative')}>
                        <span>{props.change >= 0 ? '‚Üë' : '‚Üì'}</span>
                        <span>{formatPercent(props.change)} vs last month</span>
                    </div>
                </div>
            );
        };

        const CashFlowChart = function(props) {
            const chartRef = useRef(null);
            const chartInstance = useRef(null);
            useEffect(function() {
                if (chartRef.current) {
                    if (chartInstance.current) chartInstance.current.destroy();
                    var ctx = chartRef.current.getContext('2d');
                    chartInstance.current = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: props.data.map(function(d) { return d.month; }),
                            datasets: [
                                { label: 'Revenue', data: props.data.map(function(d) { return d.revenue; }), backgroundColor: 'rgba(16, 185, 129, 0.8)', borderRadius: 6 },
                                { label: 'Expenses', data: props.data.map(function(d) { return d.expenses; }), backgroundColor: 'rgba(239, 68, 68, 0.8)', borderRadius: 6 }
                            ]
                        },
                        options: {
                            responsive: true, maintainAspectRatio: false,
                            plugins: { legend: { position: 'top', labels: { color: '#94a3b8', font: { family: 'DM Sans' } } } },
                            scales: { x: { grid: { display: false }, ticks: { color: '#64748b' } }, y: { grid: { color: '#2a3548' }, ticks: { color: '#64748b', callback: function(value) { return '$' + (value / 1000) + 'k'; } } } }
                        }
                    });
                }
                return function() { if (chartInstance.current) chartInstance.current.destroy(); };
            }, [props.data]);
            return <canvas ref={chartRef}></canvas>;
        };

        const CategoryList = function(props) {
            return (
                <div className="categories-list">
                    {props.categories.map(function(cat, idx) {
                        return (
                            <div key={idx} className="category-item">
                                <div className="category-info">
                                    <div className="category-dot" style={{ backgroundColor: cat.color }}></div>
                                    <span className="category-name">{cat.name}</span>
                                </div>
                                <span className="category-amount">{formatCurrency(cat.amount)}</span>
                            </div>
                        );
                    })}
                </div>
            );
        };

        const TransactionsTable = function(props) {
            return (
                <div className="transactions-section">
                    <div className="section-header">
                        <h2 className="section-title">Recent Transactions</h2>
                        <div className="filter-tabs">
                            <button className={"filter-tab " + (props.filter === 'all' ? 'active' : '')} onClick={function() { props.setFilter('all'); }}>All</button>
                            <button className={"filter-tab " + (props.filter === 'income' ? 'active' : '')} onClick={function() { props.setFilter('income'); }}>Income</button>
                            <button className={"filter-tab " + (props.filter === 'expense' ? 'active' : '')} onClick={function() { props.setFilter('expense'); }}>Expenses</button>
                        </div>
                    </div>
                    <table className="transactions-table">
                        <thead><tr><th>Date</th><th>Description</th><th>Category</th><th>Type</th><th style={{ textAlign: 'right' }}>Amount</th></tr></thead>
                        <tbody>
                            {props.transactions.filter(function(t) { return props.filter === 'all' || t.type === props.filter; }).map(function(t) {
                                return (
                                    <tr key={t.id}>
                                        <td>{t.date}</td>
                                        <td>{t.description}</td>
                                        <td>{t.category}</td>
                                        <td><span className={"transaction-type " + t.type}>{t.type === 'income' ? '‚Üë Income' : '‚Üì Expense'}</span></td>
                                        <td className={"amount-cell " + (t.amount >= 0 ? 'positive' : 'negative')} style={{ textAlign: 'right' }}>{t.amount >= 0 ? '+' : ''}{formatCurrency(Math.abs(t.amount))}</td>
                                    </tr>
                                );
                            })}
                        </tbody>
                    </table>
                </div>
            );
        };

        const DOOSection = function(props) {
            var dooEarnings = props.profit * (props.percentage / 100);
            var monthlyAvg = props.monthlyData.reduce(function(acc, m) { return acc + m.profit; }, 0) / props.monthlyData.length;
            var projectedAnnual = monthlyAvg * 12 * (props.percentage / 100);
            return (
                <div className="doo-section">
                    <div className="doo-header">
                        <h2 className="doo-title">üí∞ DOO Profit Share Calculator</h2>
                        <div className="doo-config">
                            <label>Profit Share %:</label>
                            <input type="number" value={props.percentage} onChange={function(e) { props.setPercentage(Number(e.target.value)); }} min="0" max="100" />
                        </div>
                    </div>
                    <div className="doo-grid">
                        <div className="doo-stat"><div className="doo-stat-label">This Month's Share</div><div className="doo-stat-value">{formatCurrency(props.monthlyData[props.monthlyData.length - 1].profit * (props.percentage / 100))}</div></div>
                        <div className="doo-stat"><div className="doo-stat-label">YTD Total Share</div><div className="doo-stat-value">{formatCurrency(dooEarnings)}</div></div>
                        <div className="doo-stat"><div className="doo-stat-label">Projected Annual</div><div className="doo-stat-value">{formatCurrency(projectedAnnual)}</div></div>
                    </div>
                    <div className="monthly-grid">
                        {props.monthlyData.map(function(m, idx) {
                            return (
                                <div key={idx} className={"month-card " + (idx === props.monthlyData.length - 1 ? 'current' : '')}>
                                    <div className="month-name">{m.month}</div>
                                    <div className={"month-profit " + (m.profit >= 0 ? 'positive' : 'negative')}>{formatCurrency(m.profit * (props.percentage / 100))}</div>
                                    <div className="month-revenue">+{formatCurrency(m.revenue)}</div>
                                    <div className="month-expenses">-{formatCurrency(m.expenses)}</div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        const SetupScreen = function(props) {
            return (
                <div className="setup-container">
                    <div className="setup-icon">üìä</div>
                    <h1 className="setup-title">Connect QuickBooks Online</h1>
                    <p className="setup-desc">Connect your QuickBooks Online account to start tracking your revenue, expenses, and profitability in real-time. Your DOO will be able to see exactly what they'll earn based on company profits.</p>
                    <button className="setup-btn" onClick={function() { props.onConnect(false); }}><span>üîó</span>Connect to QuickBooks</button>
                    <p style={{ marginTop: '24px', color: 'var(--text-muted)', fontSize: '14px' }}>Or <button onClick={function() { props.onConnect(true); }} style={{ background: 'none', border: 'none', color: 'var(--accent-blue)', cursor: 'pointer', textDecoration: 'underline' }}>view demo dashboard</button></p>
                </div>
            );
        };

        const Dashboard = function(props) {
            const [dateRange, setDateRange] = useState('6m');
            const [transactionFilter, setTransactionFilter] = useState('all');
            const [lastSync, setLastSync] = useState(new Date());
            return (
                <div className="app-container">
                    <header className="header">
                        <div className="logo-section">
                            <div className="logo-icon">A$</div>
                            <div className="logo-text"><h1>ASAP Credit Repair</h1><span>Financial Dashboard</span></div>
                        </div>
                        <div className="header-actions">
                            <div className="sync-status"><div className="sync-dot"></div><span>Last sync: {lastSync.toLocaleTimeString()}</span></div>
                            <button className="connect-btn">‚öôÔ∏è Settings</button>
                        </div>
                    </header>
                    <div className="date-filter">
                        {['1m', '3m', '6m', 'YTD', '1y', 'All'].map(function(range) {
                            return <button key={range} className={"date-btn " + (dateRange === range ? 'active' : '')} onClick={function() { setDateRange(range); }}>{range}</button>;
                        })}
                    </div>
                    <div className="kpi-grid">
                        <KPICard label="Total Revenue" value={props.data.summary.totalRevenue} change={props.data.summary.revenueChange} type="revenue" />
                        <KPICard label="Total Expenses" value={props.data.summary.totalExpenses} change={props.data.summary.expensesChange} type="expenses" />
                        <KPICard label="Net Profit" value={props.data.summary.netProfit} change={props.data.summary.profitChange} type="profit" />
                        <KPICard label="DOO Profit Share" value={props.data.summary.netProfit * (props.dooPercentage / 100)} change={props.data.summary.profitChange} type="doo" />
                    </div>
                    <div className="charts-grid">
                        <div className="chart-card"><div className="chart-header"><h3 className="chart-title">Cash Flow Overview</h3></div><div className="chart-container"><CashFlowChart data={props.data.monthlyData} /></div></div>
                        <div className="chart-card"><div className="chart-header"><h3 className="chart-title">Expense Breakdown</h3></div><CategoryList categories={props.data.categories} /></div>
                    </div>
                    <DOOSection profit={props.data.summary.netProfit} monthlyData={props.data.monthlyData} percentage={props.dooPercentage} setPercentage={props.setDooPercentage} />
                    <TransactionsTable transactions={props.data.transactions} filter={transactionFilter} setFilter={setTransactionFilter} />
                </div>
            );
        };

        const App = function() {
            const [isConnected, setIsConnected] = useState(false);
            const [isLoading, setIsLoading] = useState(true);
            const [data, setData] = useState(DEMO_DATA);
            const [dooPercentage, setDooPercentage] = useState(CONFIG.DOO_DEFAULT_PERCENTAGE);

            var handleConnect = function(demo) {
                if (demo) { setIsConnected(true); return; }
                if (CONFIG.QUICKBOOKS_CLIENT_ID && CONFIG.API_BASE_URL) {
                    var authUrl = "https://appcenter.intuit.com/connect/oauth2?client_id=" + CONFIG.QUICKBOOKS_CLIENT_ID + "&response_type=code&scope=com.intuit.quickbooks.accounting&redirect_uri=" + encodeURIComponent(CONFIG.REDIRECT_URI) + "&state=security_token";
                    window.location.href = authUrl;
                } else { setIsConnected(true); }
            };

            useEffect(function() {
                // Check if already connected on load
                fetch(CONFIG.API_BASE_URL + '/api/quickbooks/status')
                    .then(function(res) { return res.json(); })
                    .then(function(status) {
                        if (status.connected) {
                            setIsConnected(true);
                            return fetch(CONFIG.API_BASE_URL + '/api/quickbooks/data');
                        } else {
                            setIsLoading(false);
                            return null;
                        }
                    })
                    .then(function(res) { return res ? res.json() : null; })
                    .then(function(financialData) {
                        if (financialData && !financialData.error) {
                            setData(financialData);
                        }
                        setIsLoading(false);
                    })
                    .catch(function(err) {
                        console.log('Status check error:', err);
                        setIsLoading(false);
                    });

                // Also check URL params
                var urlParams = new URLSearchParams(window.location.search);
                var connected = urlParams.get('connected');
                if (connected === 'true') {
                    setIsConnected(true);
                    window.history.replaceState({}, document.title, window.location.pathname);
                }
            }, []);

            if (isLoading) return (<div className="loading-overlay"><div className="spinner"></div><div className="loading-text">Loading dashboard...</div></div>);
            if (!isConnected) return <SetupScreen onConnect={handleConnect} />;
            return <Dashboard data={data} dooPercentage={dooPercentage} setDooPercentage={setDooPercentage} />;
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
